name: idbac_analysis_workflow
displayname: STUFF
Views:
-   name: Downstream Interactive IDBac Analysis
    displayname: Downstream Interactive IDBac Analysis
    viewname: downstreamanalysis
    displaytype: linkout
    parameters:
        baseurl: https://analysis.idbac.org/
        urlparam:
            -   task:[task]
-   name: section
    displayname: Output Tables
    viewname: section
    displaytype: section

-   name: Query Spectra Summary
    displayname: Query Spectra Summary
    viewname: results
    displaytype: datatable
    parameters:
        filename: nf_output/query/summary.tsv
        error_missingfile: "No File"
        columns:
            -   title: "Visualize"
                data: 
            -   title: "scan"
                data: scan
            -   title: "filename"
                data: filename
        columnDefs: '[ {"targets": 0,"data": null,"render": function ( data, type, row, meta ) {
        return `
            <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["filename"]}:scan:${row["scan"]}">View Spectrum in Resolver</a>
            <br>
            <a target="_blank" href="/dashboards/embedded/resolver/?usi=mzspec:GNPS2:TASK-${task}-nf_output/merged/${encodeURIComponent(row["filename"])}:scan:${encodeURIComponent(row["scan"])}">View in GNPS2</a>
        `;}}]'

-   name: Errors
    displayname: Input File Error Summary
    viewname: errors
    displaytype: datatable
    parameters:
        filename: nf_output/errors.csv
        error_missingfile: "No Errors Found"
        columns:
            -   title: "Filename"
                data: Filename
            -   title: "Error"
                data: Error

# -   name: Visualize Dendrogram
#     displayname: Visualize Dendrogram
#     viewname: visualize
#     displaytype: linkout
#     parameters:
#         baseurl: /taskresult/[task]/file/nf_output/output.html
#         urlparam:
#             -   attachment:no

# -   name: Visualize Dendrogram with Metadata
#     displayname: Visualize with Metadata
#     viewname: visualizewithmetadata
#     displaytype: linkout
#     parameters:
#         baseurl: /taskresult/[task]/file/nf_output/with_metadata.html
#         urlparam:
#             -   attachment:no

# -   name: Dendrogram Distance
#     displayname: Dendrogram Distance
#     viewname: dendrogramresults
#     displaytype: datatable
#     parameters:
#         filename: nf_output/output_distance_table.tsv
#         error_missingfile: "No File"
#         columns:
#             -   title: "View Match"
#                 data: "label_i"
#             -   title: "label_i"
#                 data: "label_i"
#             -   title: "label_j"
#                 data: "label_j"
#             -   title: "distance"
#                 data: "distance"
#         columnDefs: '[ {"targets": 0,"data": null,"render": function ( data, type, row, meta ) {
#         return `
#             <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_i"]}:scan:1">View Spectrum 1 - Resolver</a>
#             <br>
#             <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_j"]}:scan:1">View Spectrum 2 - Resolver</a>
#             <br>
#             <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_i"]}:scan:1&usi2=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_j"]}:scan:1">View Mirror - Resolver</a>
#             <br>
#             <a target="_blank" href="/dashboards/embedded/resolver/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_i"]}:scan:1">View Spectrum 1 - Local</a>
#             <br>
#             <a target="_blank" href="/dashboards/embedded/resolver/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_j"]}:scan:1">View Spectrum 2 - Local</a>
#             <br>
#             <a target="_blank" href="/dashboards/embedded/resolver/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_i"]}:scan:1&usi2=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["label_j"]}:scan:1">View Mirror - Local</a>
#         `;}}]'

-   name: Database Search Summary
    displayname: Database Search Summary
    viewname: dbresults
    displaytype: datatable
    parameters:
        filename: nf_output/search/enriched_db_results.tsv
        error_missingfile: "No File"
        columns:
            -   title: "View"
                data: None
            -   title: "query_filename"
                data: "query_filename"
            -   title: "query_index"
                data: "query_index"
            -   title: "database_id"
                data: "database_id"
            -   title: "database_scan"
                data: "database_scan"
            -   title: "db_strain_name"
                data: "db_strain_name"
            -   title: "db_culture_collection"
                data: "db_culture_collection"
            -   title: "db_taxonomy"
                data: "db_taxonomy"
            -   title: "distance"
                data: "distance"
        columnDefs: '[ {"targets": 0,"data": null,"render": function ( data, type, row, meta ) {
        return `
            <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["query_filename"]}:scan:1">View Query - Resolver </a>
            <br>
            <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/search/output_database.mgf:scan:${row["database_scan"]}">View Database - Resolver </a>
            <br>
            <a target="_blank" href="https://metabolomics-usi.gnps2.org/dashinterface/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["query_filename"]}:scan:1&usi2=mzspec:GNPS2:TASK-${task}-nf_output/search/output_database.mgf:scan:${row["database_scan"]}">View Mirror - Resolver</a>
            <br>
            <a target="_blank" href="/dashboards/embedded/resolver/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["query_filename"]}:scan:1">View Query - Local</a>
            <br>
            <a target="_blank" href="/dashboards/embedded/resolver/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/search/output_database.mgf:scan:${row["database_scan"]}">View Database - Local</a>
            <br>
            <a target="_blank" href="/dashboards/embedded/resolver/?usi1=mzspec:GNPS2:TASK-${task}-nf_output/merged/${row["query_filename"]}:scan:1&usi2=mzspec:GNPS2:TASK-${task}-nf_output/search/output_database.mgf:scan:${row["database_scan"]}">View Mirror - Local</a>
        `;}}]'